<p *ngIf="debug">ncrequest-view works!</p>
<div class="jumbofix jumbotron">
  <div class="jumbo-content">
    <div class="jumbo-info">
      <form [formGroup]="requistionItemForm" id="requistionItemForm">
        <div class="row">
          <div class="col-md-6">
            <div class="row">
              <h4 class="col-sm-auto text-smartbuy">
                <strong i18n="@@ncrequestviewTitle"
                  >Purchase Order Request # &nbsp;
                  {{ requistionItemForm.value.requistionfrNumber
                  }}<span *ngIf="sappono">, &nbsp; SAP PO # &nbsp;</span>
                  <span id="sappono">{{ sappono }}</span>
                </strong>
              </h4>
            </div>
          </div>
          <div class="col-md-6">
            <div class="row">
              <h4 class="col-sm-auto text-smartbuy">
                <strong i18n="@@ncrequestviewStatus"
                  >Status:&nbsp;<span *ngIf="documentStatus">
                    <span name="vpor_status" [innerHTML]="errTransService.returnMsg(documentStatus.status, true)"></span></span
                ></strong>
              </h4>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="row">
              <div class="form-group col-sm-auto">
                <span><strong i18n="@@ncrequestviewCBy">Created By: </strong></span>
                <span name="vpor_by">
                  {{ createdBy }}
                </span>
              </div>
              <div class="form-group col-sm-auto">
                <span><strong i18n="@@ncrequestviewReBy">Req By: </strong></span>
                <span name="vpor_req">
                  {{ requestDetailsForm.value.requester }}
                  <!-- TODO: see above -->
                </span>
              </div>
              <div class="form-group col-sm-auto">
                <span><strong i18n="@@ncrequestviewDate">Date: </strong></span>
                <span name="vpor_on">
                  {{ createdOn | date : dateFormat }}
                </span>
              </div>
              <div class="form-group col-sm-auto" *ngIf="poDetails">
                <span><strong i18n="@@ncrequestviewPC">Purchase Category: </strong></span>
                <span name="vpor_pc">
                  {{ poDetails?.porRequest?.purchaseCategory?.displayname }}
                </span>
              </div>
              <div class="form-group col-sm-auto">
                <span><strong i18n="@@ncrequestviewVendorName">Vendor Name: </strong></span>
                <span name="vpor_vendor">
                  {{ poDetails?.porRequest?.vendor?.displayname }}
                  <!-- TODO: change to vendor name only when autoselect pre-set values issue is resolved -->
                </span>
              </div>
              <div class="form-group col-sm-auto">
                <span><strong i18n="@@ncrequestviewCC">Cost Center: </strong></span>
                <span name="vpor_cc">
                  {{ getCostCenterDisplay() }}
                </span>
              </div>
              <div class="form-group col-sm-auto" *ngIf="poDetails && !poDetails?.porRequest?.itemDetails[0]?.distribution[0]?.objectAssetClass?.id">
                <span><strong i18n="@@ncrequestviewGLAccount">GL Account: </strong></span>
                <span name="vpor_gl">
                  <!-- {{ poDetails.porRequest.costObjectGlAccount.displayname }} -->
                  {{ poDetails?.porRequest?.itemDetails[0]?.distribution[0]?.objectGlAccount?.displayname }}
                </span>
              </div>
              <div class="form-group col-sm-auto" *ngIf="poDetails && poDetails?.porRequest?.itemDetails[0]?.distribution[0]?.objectAssetClass?.id">
                <span><strong i18n="@@ncrequestviewAssetType">Asset Type: </strong></span>
                <span name="vpor_assetinfo">
                  {{ poDetails?.porRequest?.itemDetails[0]?.distribution[0]?.objectAssetClass?.displayname }}
                </span>
              </div>
              <div class="form-group col-sm-auto">
                <span for="requistionfrCost"
                  ><strong i18n="@@ncrequestviewTotalCost">Total Cost (USD)</strong
                  ><!-- <strong [hidden]="hideIfUsd()">&nbsp;(USD)</strong> --><strong
                    >: $</strong
                  ></span
                >
                <span name="vpor_rcost"> {{ requistionItemForm.value.requistionfrCost | customNumber : numberFormat}} </span>
              </div>
              <div class="form-group col-sm-auto" *ngIf="!hideIfUsd()">
                <span>
                  <strong i18n="@@ncrequestviewTotalCost1">Total Cost ({{poDetails?.porRequest?.orderCurrency.displayname}}) : </strong>
                  <span id="otherCurrency">{{poDetails?.porRequest?.localCost | customCurrency : poDetails?.porRequest?.orderCurrency?.displayname.split(' - ')[0] : numberFormat}}</span>
                </span>
              </div>
              <div class="form-group col-sm-auto" *ngIf="poDetails">
                <span id="newPoValue">
                  <strong *ngIf="poDetails.porRequest.newPoValue" name="vpor_revisedpo" i18n="@@ncrequestviewRevisedPO"
                    >Revised Po Value in SAP:</strong
                  >{{ poDetails.porRequest.newPoValue || "" }}
                </span>
              </div>
              <div class="form-group col-sm-auto" *ngIf="poDetails">
                <span id="newPoComments">
                  <strong *ngIf="poDetails.porRequest.newPoComments" name="vpor_rcomments" i18n="@@ncrequestviewRevComments"
                    >Revision Comments: </strong
                  >{{ poDetails.porRequest.newPoComments || "" }}
                </span>
              </div>
              <!-- <div class="form-group col-sm-auto">
                <span for="requistionfrStatus"><strong>Status :</strong></span>
                <span>
                  {{ requistionItemForm.value.requistionfrStatus }}
                </span>
              </div>
              <div class="form-group col-sm-auto">
                <span
                  for="requistionfrOrderDetail"
                  ><strong>Order :</strong></span
                >
                <span>
                  {{ requistionItemForm.value.requistionfrOrderId }}
                </span>
              </div> -->
            </div>
            <div class="form-group row">
              <div class="col-lg-8">
                <label for="requistionfrComments"
                  ><strong i18n="@@ncrequestviewInternalComments">Brief Description of Purchase/Internal Comments* ?&nbsp;</strong>
                  <span
                    class="tooltip--right"
                    name='npor_ttcomments'
                    i18n-[attr.data-tooltip]="@@ncrequestview_TT1"
                    [attr.data-tooltip]="
                      'Comments for those who will review or approve the POR; will not be sent to vendor.'
                    "
                    ><i class="pe-7s-help1"></i
                  ></span>
                  </label
                >
                <textarea
                  name="requistionfrComments"
                  id="requistionfrComments"
                  formControlName="requistionfrComments"
                  class="form-control"
                ></textarea>
              </div>
            </div>
            <span id="needsAssetNumber"></span>
            <div class="form-group row custom-mobile-button-group">
              <div class="col-sm-auto">
                <button
                  class="btn btn-success"
                  i18n="@@ncrequestviewApprove"
                  name="vpor_approve"
                  (click)="onApproveClick()"
                  [disabled]="(!checkcomment || needs.assetNumber) && !hasApprovalAccess"
                >
                  <i class="pe-7s-check"></i> Approve

                </button>
              </div>
              <div class="col-sm-auto">
                <button
                  class="btn btn-warning btn-gold"
                  (click)="askQuestionModal.open()"
                  name="vpor_pending"
                  i18n="@@ncrequestviewAsk"
                  id="pendingClarification"
                  [disabled]="!checkcomment && !hasApprovalAccess"
                >
                  <!-- [disabled]="!checkcomment" -->
                  <i class="pe-7s-help1"></i> Ask a question

                </button>
              </div>
              <div class="col-sm-auto">
                <button
                  class="btn btn-danger"
                  (click)="onRejectClick()"
                  i18n="@@ncrequestviewReject"
                  name="vpor_reject"
                  [disabled]="!checkcomment && !hasApprovalAccess"
                >
                  <i class="pe-7s-close-circle"></i> Reject

                </button>
              </div>
            </div>
            <!-- <div class="form-group row mt-4" *ngIf="needsClarification">
              <div class="col-lg-8">
                <label for="clarifications"
                  ><strong>Clarification Notes</strong></label
                >
                <textarea
                  formControlName="clarifications"
                  id="clarifications"
                  class="form-control"
                ></textarea>
                <button
                  class="btn btn-primary btn-sm"
                  [disabled]="!requistionItemForm.value.clarifications"
                  (click)="onClarificationClick()"
                >
                  Submit Clarification
                </button>
              </div>
            </div> -->
            <div class="row">
              <form
                *ngIf="this.poDetails?.porRequest.sapOrder"
                class="card shadow-lg p-4 mt-4"
                [formGroup]="updatePoForm"
              >
                <i class="pe-7s-note text-primary cursor-pointer" name="vpor_toggleupdate"
                  (click)="togglePoUpdate()"
                ></i>
                <div class="form-row align-items-center">
                  <!-- <div class="form-group col-sm-auto"> -->
                  <div class="col">
                    <label for="myNewPoNumber"><span i18n="@@ncrequestviewRevPO">Revised PO Value in SAP:&nbsp;</span>
                      <span
                    class="align-self-center tooltip--right position-relative"
                    i18n-[attr.data-tooltip]="@@ncrequestview_TT2"
                    [attr.data-tooltip]="
                      'Buyer must enter revised PO value in this field for information to available in EProcurement'
                    "
                    ><i class="pe-7s-help1"></i
                  ></span>
                    </label>

                  </div>
                  <div class="col">
                    <input
                      class="form-control"
                      type="number"
                      autocomplete="off"
                      formControlName="newNumber"
                      name="vpor_newpo"
                      id="myNewPoNumber"
                      min="1"
                      onkeyup="if(this.value < 1) this.value = 1;"
                    />
                  </div>
                  <div class="col">
                    <label for="myNewPoExplanation"><span i18n="@@ncrequestviewReasonForChange">Reason for Change:&nbsp;</span>
                      <span
                      class="align-self-center tooltip--right position-relative"
                      i18n-[attr.data-tooltip]="@@ncrequestview_TT3"
                      [attr.data-tooltip]="
                        'Buyer must enter reason for change in this field for information to available in EProcurement'
                      "
                      ><i class="pe-7s-help1"></i
                    ></span>

                    </label>
                  </div>
                  <div class="col">
                    <textarea
                      formControlName="newExplanation"
                      id="myNewPoExplanation"
                      name="vpor_newpoexp"
                      class="form-control"
                    ></textarea>
                  </div>
                  <div class="col">
                    <button
                      class="button-fix btn btn-primary"
                      name="vpor_submitpono"
                      i18n="@@ncrequestviewSubmitBtn"
                      [disabled]="
                        !updatePoForm.value.newNumber ||
                        !updatePoForm.value.newExplanation
                      "
                      (click)="submitPoNumberUpdate()"
                    >
                      Submit
                    </button>
                  </div>
                  <!-- </div> -->
                </div>
              </form>
            </div>
            <div class="row" *ngIf="checkcomment || hasApprovalAccess"> <!-- only display if we are active approver -->
              <div class="col-md-6">
                <ngx-spinner name="additionalApprover">
                  <p class="loading" i18n="@@ncrequestviewFetchingData">Fetching data...</p>
                </ngx-spinner>
                <label><strong i18n="@@ncrequestviewAddApp">Additional Approvers:</strong></label>
                <div *ngFor="let approver of savedAdditionalApprovers; let i = index">
                  <span id="{{'addapp'+ i}}"> &nbsp;{{displayUser(approver.userId)}} &nbsp;</span>
                  <span id="{{'deleteapp'+i}}"
                    *ngIf="approver.status == 1 || approver.status == 2"
                    (click)="deleteAdditionalApprover(approver)"
                    class="badge badge-danger-fix cursor-pointer"
                    [hidden]="approver.userId == getUserAdId()"
                  >
                    <i class="pe-7s-trash"></i>
                  </span>
                </div>
                <br/>
                <button i18n="@@ncrequestviewAddAA" *ngIf="!showAdditional" name="vpor_additionalbtn" class="btn btn-primary button-fix" (click)="addAdditional()">
                  Add Additional Approvers
                </button>
              </div>
            </div>
            <br/>
            <div class="row" *ngIf="showAdditional">
              <div class="col-sm-12">
                <div class="row">
                  <div class="col-md-6">
                    <ng-select
                    [items]="approverOptions?.additionalapprovers[0]?.users"
                    bindValue="id"
                    bindLabel="displayname"
                    id="additionalApprover"
                    name="vpor_addapplist"
                    [attr.name]="additionalApprover"
                    [(ngModel)]="chosenApprover"
                    [ngModelOptions]="{standalone: true}"
                    (change)="onApproversChange($event)"
                    i18n-placeholder="@@ncrequestviewSelectAA"
                    placeholder="Select Additional Approver"
                    class="approver"
                  >
                  </ng-select>
                  </div>
                  <div class="col-md-auto">
                    <div>
                      <span class="btn btn-secondary m-2" *ngFor="let item of additionalApproverListToSend"
                        >{{ displayUser(item)}}
                        <a (click)="onRemoveApprover(item)"><i class="pe-7s-close"></i></a>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="row" *ngIf="showVP">
                  <div class="col-md-6">
                    <br/><label for="vpOptions" i18n="@@ncrequestviewVPApp">Approver* &nbsp; </label>
                    <ng-select
                    [items]="vpOptions"
                    bindValue="id"
                    bindLabel="displayname"
                    id="vpOptions"
                    [(ngModel)]="selectedVP"
                    [ngModelOptions]="{standalone: true}"
                    name="vpOptions"
                    i18n-placeholder="@@ncrequestviewSelectVPApp"
                    placeholder="Select Approver"
                    class="approver"
                  >
                  </ng-select>
                    <br/>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <br/>
                    <button i18n="@@ncrequestviewSubmitApp" name="vpor_submitaddapp" (click)="SubmitAdditionalApprovers()" class="btn btn-primary button-fix">
                      Submit Approvers
                    </button>
                    <br/>
                  </div>
                </div>
              </div>

            </div>
          </div>
          <div class="col-md-auto">
            <div class="form-group row d-none">
              <label class="col-sm-auto col-form-label">
                <strong i18n="@@ncrequestviewPendingWith"> Pending With:&nbsp;<span></span> </strong>
              </label>
            </div>
            <div class="row">
              <div>
                <h1 *ngIf="debug">
                  Turn debug value to FALSE to see real api data
                </h1>
                <div class="row">
                  <div class="timeline-centered">
                    <ng-container *ngFor="let name of hierarchy; let i = index">
                      <article class="timeline-entry remove-last">
                        <div class="timeline-entry-inner">
                          <div
                            class="timeline-icon"
                            [ngClass]="{
                              'bg-success': name.name.includes('@'),
                              'bg-danger':
                                name.name.includes('^') &&
                                !name.name.includes('@'),
                              'bg-gold':
                                (name.name.includes('#') &&
                                  !name.name.includes('^') &&
                                  !name.name.includes('@')) ||
                                (!name.name.includes('@') &&
                                  !name.name.includes('^') &&
                                  !name.name.includes('#'))
                            }"
                          >
                            <i
                              class="entypo-feather bigger-font"
                              [ngClass]="{
                                'pe-7s-angle-down': hierarchy[i + 1]
                              }"
                            ></i>
                          </div>
                          <div class="timeline-label"
                            [ngClass]="{'custom-pending-approval': name.name.includes('#') &&
                              !name.name.includes('^') &&
                              !name.name.includes('@')}"
                          >
                            <h2
                              [innerHTML]="name.name | approverHierarchy:{date: name.displayDt, approval: sendHierarchyApprovalString(name), dateFormat: dateFormat}"
                            ></h2>
                            <h6
                              *ngIf="name.fieldName"
                              class="text-smartbuy"
                              [innerText]="name.fieldName"
                            ></h6>
                            <!-- <div
                              *ngIf="
                                !name.name.includes('^') &&
                                name.name.includes('@')
                              "
                            >
                              Approved
                            </div>
                            <div
                              *ngIf="
                                name.name.includes('^') &&
                                !name.name.includes('@')
                              "
                            >
                              Reject
                            </div>
                            <div
                              *ngIf="
                                name.name.includes('#') &&
                                !name.name.includes('^') &&
                                !name.name.includes('@')
                              "
                            >
                              Pending Approval
                            </div> -->
                            <!--<div
                              *ngIf="
                                !name.name.includes('#') &&
                                !name.name.includes('^') &&
                                !name.name.includes('@')
                              "
                            >
                              Pending
                            </div>-->
                            <p
                              class="text-sm"
                              *ngIf="name.title"
                              [innerHTML]="name.title"
                            ></p>
                            <!-- <span
                              *ngIf="
                                name.name.includes('^') ||
                                name.name.includes('@')
                              "
                            >
                              <span
                                class="text-sm"
                                *ngIf="name.displayDt"
                                [innerHTML]="name.displayDt"
                              ></span>
                            </span> -->
                          </div>
                        </div>
                      </article>
                    </ng-container>
                    <article class="timeline-entry">
                      <div class="timeline-entry-inner">
                        <div class="timeline-icon">
                          <i class="entypo-feather"></i>
                        </div>
                        <div class="timeline-label" *ngIf="sappono">
                          <p i18n="@@ncrequestviewPOSAP">
                            PO # <span id="sappono2">{{ sappono }}</span> is
                            created in SAP.
                          </p>
                        </div>
                      </div>
                    </article>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>

    </div>

    <!-- Bootsnipp from https://bootsnipp.com/snippets/mMWql -->
    <div class="shadow-lg card m-5">
      <div class="css3-tabstrip">
        <ul>
          <li>
            <input
              type="radio"
              name="css3-tabstrip-0"
              checked="checked"
              id="css3-tabstrip-0-0"
            /><label for="css3-tabstrip-0-0" i18n="@@ncrequestviewComments">Comments/History</label>
            <div>
              <table class="table mt-0 mb-0">
                <thead>
                  <tr>
                    <th scope="col" i18n="@@ncrequestviewCBy">Created By</th>
                    <!--<th scope="col">requestid</th>-->
                    <th scope="col" i18n="@@ncrequestviewCAt">Created At</th>
                    <th scope="col" i18n="@@ncrequestviewComment">Comment</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let tblv of loadGrid; let i = index">
                    <!--<td>{{ tblv.requestid }} tblv.addwho</td>-->

                    <td id="{{'name'+i}}">
                      <span *ngFor="let user of adUsers">
                        <span *ngIf="user.ID == tblv.addwho">
                          {{ user.firstname }}&nbsp;{{ user.lastname }}
                        </span>
                      </span>
                    </td>
                    <td id="{{'ddate'+i}}">
                      {{ tblv.displayDate | date : dateTime }}
                    </td>
                    <td id="{{'comment'+i}}">{{ tblv.comment }}</td>
                    <td></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </li>
          <li>
            <input
              type="radio"
              name="css3-tabstrip-0"
              id="css3-tabstrip-0-1"
            /><label for="css3-tabstrip-0-1"><span  i18n="@@ncrequestviewAttachments">Attachments</span>
              <span
              class="align-self-center tooltip--right position-relative"
              i18n-[attr.data-tooltip]="@@ncrequestview_TT4"
              [attr.data-tooltip]="
                'Attach any document (Word, Excel, PDF) that helps explain or support the purchase, such as a vendor quote or contract summary.'
              "
              ><i class="pe-7s-help1"></i
            ></span><span *ngIf="fileList && fileList[0]">&nbsp;<i class="pe-7s-paperclip align-self-center position-relative"></i></span>
            </label>
            <div>
              <div class="custom-table-wrapper row">
                <div class="custom-table-scroll m-0 p-0 col-md-9">
                <table class="table file-table mt-0 mb-0">
                <thead>
                  <tr>
                    <th i18n="@@ncrequestviewFile">File</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let file of fileList; let i = index">
                    <td>
                      <span id="{{'file'+i}}" class="text-primary mr-4">
                        {{ file }}
                      </span>
                      <span class="badge badge-primary-fix cursor-pointer" id="{{'filedownload'+i}}"
                        (click)="onFileDownloadClick(file)">
                        <i class="pe-7s-download"></i>
                      </span>

                    </td>
                  </tr>
                </tbody>
                </table>
              </div>
              <div class="col-md-auto">
                  <form [formGroup]="commentsForm">
                    <div class="custom-file w-100 mr-1">
                      <input
                        type="file"
                        class="custom-file-input"
                        name="customfile"
                        id="customFile"
                        formControlName="uploadFile"
                        (change)="onFileUpload($event.target.files)"
                        multiple
                      />
                      <label
                        class="custom-file-label"
                        for="customFile"
                        name="uploadfile"
                        id="uploadFileLabel"
                        i18n-[innerText]="@@ncrequestviewAttachFile"
                        [innerText]="'Attach a file...'"
                      ></label>
                    </div>

                    <!-- <div *ngFor="let file of filesToDisplay" class="badge m-1 ml-2">
                      <span>{{ file }}</span
                      ><a (click)="onRemoveSelectedFile(file)"
                        ><i class="pe-7s-close custom-close-me"></i
                      ></a>
                    </div> -->
                    <!-- <hr *ngIf="filesToDisplay[0]">
                    <div>
                      <button
                        *ngIf="filesToDisplay[0]"
                        class="btn btn-primary button-fix"
                        (click)="prepareFileUpload()"
                      >
                        Submit Files
                      </button>
                    </div> -->
                  </form>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <!-- End bootsnipp -->
  </div>
</div>
<form [formGroup]="typeForm">
  <div class="card p-4 m-5 shadow-lg">
    <a name="vpor_home" (click)="onHomeClick()">
      <span class="custom-lg-div-btn text-muted"
        ><i class="pe-7s-home"></i
      ></span>
    </a>
    <div class="row align-content-center align-items-center">
      <div class="col-sm-2">
        <h3 i18n="@@ncrequestviewPOR">Purchase Order Request</h3>
      </div>
      <div class="col-sm-10">
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="reqRadios"
            formControlName="reqRadios"
            id="reqRadios1"
            value="1"
            disabled
          />
          <label i18n="@@ncrequestviewGoods" class="form-check-label" for="reqRadios1">
            Goods&nbsp;
          </label>
          <span
          class="align-self-center tooltip--right position-relative"
          name="npor_tt35_1"
          i18n-[attr.data-tooltip]="@@ncrequestview_TT5"
          [attr.data-tooltip]="
            'This selection will determine the fields to be completed in the POR.'
          "
          ><i class="pe-7s-help1"></i
        ></span>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="reqRadios"
            formControlName="reqRadios"
            id="reqRadios2"
            value="2"
            disabled
          />
          <label i18n="@@ncrequestviewServices" class="form-check-label" for="reqRadios2">
            Services&nbsp;
          </label>
          <span
          class="align-self-center tooltip--right position-relative"
          name="npor_tt35_1"
          i18n-[attr.data-tooltip]="@@ncrequestview_TT6"
          [attr.data-tooltip]="
            'This selection will determine the fields to be completed in the POR.'
          "
          ><i class="pe-7s-help1"></i
        ></span>
        </div>
        <div class="form-check disabled">
          <input
            class="form-check-input"
            type="radio"
            name="reqRadios"
            formControlName="reqRadios"
            id="reqRadios3"
            value="3"
            disabled
          />
          <label i18n="@@ncrequestviewGS" class="form-check-label" for="reqRadios3">
            Goods + Services &nbsp;
          </label>
          <span
          class="align-self-center tooltip--right position-relative"
          name="npor_tt35_1"
          i18n-[attr.data-tooltip]="@@ncrequestview_TT7"
          [attr.data-tooltip]="
            'This selection will determine the fields to be completed in the POR.'
          "
          ><i class="pe-7s-help1"></i
        ></span>
        </div>
      </div>
    </div>

    <div class="d-flex flex-row justify-content-around">
      <div class="text-center">
        <div class="p-2">
          <p i18n="@@ncrequestviewCreatedBy">
            Created By:
            <strong name="vpor_createdby">{{ createdBy }}</strong>
          </p>
        </div>
      </div>
      <div class="text-center">
        <div class="p-2">
          <p i18n="@@ncrequestviewCreatedOn">
            Created On: <strong name="vpor_createdon">{{ createdOn | date : dateFormat }}</strong>
          </p>
        </div>
      </div>
    </div>
  </div>
</form>
<form [formGroup]="isApprovedForm">
  <div class="card p-4 m-5 shadow-lg">
    <div class="row justify-content-start justify-items-start">
      <div class="col-md-4">
        <p><span i18n="@@ncrequestviewISB">Is budget approved for this request? &nbsp;</span>
          <span
          name='npor_tt1'
            class="tooltip--right"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT8"
            [attr.data-tooltip]="
              'If purchase is not part of an approved budget, enter explanation.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
        </p><i
        class="pe-7s-note text-primary cursor-pointer"
        name="vpor_editbudget"
        *ngIf="showEdit"
        (click)="editBudgetNotApproved('budgetNotApproved')"
        [hidden]="editableChecked.docApproved && !hasApprovalAccess"
      ></i>
      </div>
      <div class="col-md-2">
        <div class="form-row justify-content-around">
          <div class="col-md-auto form-check">
            <input
              class="form-check-input"
              type="radio"
              name="budgetApproved"
              formControlName="budgetApproved"
              id="budgetApproved1"
              value="1"

            />
            <label i18n="@@ncrequestviewYes" class="form-check-label" for="budgetApproved1">
              Yes
            </label>
          </div>
          <div class="col-md-auto form-check">
            <input
              class="form-check-input"
              type="radio"
              name="budgetApproved"
              formControlName="budgetApproved"
              id="budgetApproved2"
              value="2"

            />
            <label i18n="@@ncrequestviewNo" class="form-check-label" for="budgetApproved2">
              No
            </label>
          </div>
        </div>
      </div>
    </div>
    <div

      class="row justify-content-start justify-items-start"
    >
      <div class="col-md-8" >
        <label for="budgetNotApproved" i18n="@@ncrequestviewExp">Explanation:</label>
        <textarea id="budgetNotApproved" class="form-control" formControlName="budgetNotApproved"
        (change)="onHeaderUpdated('budgetNotApproved', $event)" name="vpor_exp"
        [disabled]="!editableChecked.budgetNotApproved"
        ></textarea>

      </div>
    </div>
    <div class="row justify-content-start justify-items-start">
      <div class="col-md-5">
        <p><span i18n="@@ncrequestviewIsC">Is a contract in place in CARS for this request?&nbsp;</span>
          <span
          class="tooltip--right"
          name='npor_tt2'
          i18n-[attr.data-tooltip]="@@ncrequestview_TT9"
          [attr.data-tooltip]="
            'Please review CARS guidelines to see if a contract is required.  If contract is not required, enter explanation.'
          "
          ><i class="pe-7s-help1"></i
        ></span>
      </p>
      </div>
      <div class="col-md-2">
        <div class="form-row justify-content-around">
          <div class="col-md-auto form-check">
            <input
              class="form-check-input"
              type="radio"
              name="contractInPlace"
              formControlName="contractInPlace"
              id="contractInPlace1"
              value="1"
            />
            <label i18n="@@ncrequestviewYes" class="form-check-label" for="contractInPlace1">
              Yes
            </label>
          </div>
          <div class="col-md-auto form-check">
            <input
              class="form-check-input"
              type="radio"
              name="contractInPlace"
              formControlName="contractInPlace"
              id="contractInPlace2"
              value="2"
            />
            <label i18n="@@ncrequestviewNo" class="form-check-label" for="contractInPlace2">
              No
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
<button class="btn btn-danger" (click)="checkForms()" *ngIf="debug">
  check console.log for form values
</button>
<form
  *ngIf="typeForm.value.reqRadios"
  [formGroup]="requestDetailsForm"
  id="requestDetailsForm"
>
  <p *ngIf="debug">Successfully opened</p>
  <div class="card p-4 m-5 shadow-lg">
    <h4 i18n="@@ncrequestviewORDetails">Order Request Details</h4>
    <span *ngIf="!adUsers" i18n="@@ncrequestviewFetchingData">Fetching data...</span>
    <div class="form-row">
      <div class="form-group col-sm-4">
        <ng-container *ngIf="editable">
          <label for="purchaseCategory"
            ><span i18n="@@ncrequestviewPC">Purchase Category </span>*&nbsp;
            <span
                class="align-self-center tooltip--right position-relative"
                name='npor_tt3'
                i18n-[attr.data-tooltip]="@@ncrequestview_TT10"
                [attr.data-tooltip]="
                  'Select a category that best fits your purchase; use \'profit center\' for PORs to be coded to cost of sales.  Use \' general other expenses \' when no other category is appropriate.'
                "
                ><i class="pe-7s-help1"></i
              ></span>
            </label
          >
          <select
            id="purchaseCategory"
            type="select"
            name="vpor_pc1"
            formControlName="purchaseCategory"
            class="form-control"
            required
            (change)="onCategoryChange()"
            disabled
          >
            <option value="" i18n="@@ncrequestviewPleaseChoose" selected disabled hidden>Please Choose...</option>
            <option
              value="{{ option.ID }}"
              *ngFor="let option of purchaseCategoryOptions"
              >{{ option.Category }}
            </option>
          </select>
        </ng-container>
        <ng-container *ngIf="!editable">
          <label><span i18n="@@ncrequestviewPC">Purchase Category &nbsp;</span>
            <span
                class="align-self-center tooltip--right position-relative"
                name='npor_tt3'
                i18n-[attr.data-tooltip]="@@ncrequestview_TT11"
                [attr.data-tooltip]="
                  'Select a category that best fits your purchase; use \'profit center\' for PORs to be coded to cost of sales.  Use \' general other expenses \' when no other category is appropriate.'
                "
                ><i class="pe-7s-help1"></i
              ></span>
          </label>
          <p name="vpor_pc2">{{ poDetails.porRequest.purchaseCategory.displayname }}</p>
        </ng-container>
      </div>
      <div class="form-group col-sm-4 ng-autocomplete hide-x">
        <ng-container *ngIf="editable">
          <label for="company"><span i18n="@@ncrequestviewCompPO">Company Placing Order *&nbsp;</span>
            <span
                class="align-self-center tooltip--right position-relative"
                name='npor_tt4'
                i18n-[attr.data-tooltip]="@@ncrequestview_TT12"
                [attr.data-tooltip]="
                  'From the drop-down menu, enter the name of the company that is placing the order.'
                "
                ><i class="pe-7s-help1"></i
              ></span>
          </label>
          <ng-autocomplete
            [data]="companyOptions"
            [searchKeyword]="'name'"
            name="vpor_comp1"
            i18n-placeholder="@@ncrequestviewEnterComp"
            placeHolder="Enter the Company name"
            historyIdentifier="companyOptions"
            [itemTemplate]="requestCompanyTemplate"
            [notFoundTemplate]="notFoundTemplate"
            formControlName="company"
            disabled
          >
          </ng-autocomplete>
          <ng-template #requestCompanyTemplate let-item>
            <a [innerHTML]="item.name"></a>
          </ng-template>
        </ng-container>
        <ng-container *ngIf="!editable">
          <label><span  i18n="@@ncrequestviewCPO1">Company Placing Order &nbsp;</span>
            <span
                class="align-self-center tooltip--right position-relative"
                name='npor_tt4'
                i18n-[attr.data-tooltip]="@@ncrequestview_TT13"
                [attr.data-tooltip]="
                  'From the drop-down menu, enter the name of the company that is placing the order.'
                "
                ><i class="pe-7s-help1"></i
              ></span>
          </label>
          <p name="vpor_comp2">
            {{ poDetails.porRequest.company.displayname }}
          </p>
        </ng-container>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group col-sm-4">
        <ng-container *ngIf="editable">
          <label for="requesterCostCenter"
            ><span i18n="@@ncrequestviewCostCenter">Cost Center </span>*&nbsp;
            <span
                class="align-self-center tooltip--right position-relative"
                name='npor_tt5'
                i18n-[attr.data-tooltip]="@@ncrequestview_TT14"
                [attr.data-tooltip]="
                  'The cost center that will be charged for the purchase.'
                "
                ><i class="pe-7s-help1"></i
              ></span>
            </label
          >
          <select
            id="requesterCostCenter"
            type="text"
            formControlName="requesterCostCenter"
            class="form-control"
            name="vpor_cc1"
            disabled
          >
            <option value="" i18n="@@ncrequestviewPleaseChoose" selected hidden disabled>Please Choose...</option>
            <option
              value="{{ item.id }}"
              *ngFor="let item of costCenterOptions"
              >{{ item.code }}</option
            >
          </select>
        </ng-container>
        <ng-container *ngIf="!editable">
          <label><span i18n="@@ncrequestviewCostCenter">Cost Center&nbsp;</span>
            <span
                class="align-self-center tooltip--right position-relative"
                name='npor_tt5'
                i18n-[attr.data-tooltip]="@@ncrequestview_TT15"
                [attr.data-tooltip]="
                  'The cost center that will be charged for the purchase.'
                "
                ><i class="pe-7s-help1"></i
              ></span>
          </label>
          <p name="vpor_cc2">{{ poDetails.porRequest.costCenter.displayname }}</p>
        </ng-container>
      </div>
      <div class="form-group col-sm-4 ng-autocomplete hide-x">
        <ng-container *ngIf="editable">
          <label for="requester"><span i18n="@@ncrequestviewReqM">Requester *&nbsp;</span>
            <span
            class="align-self-center tooltip--right position-relative"
            name='npor_tt6'
            i18n-[attr.data-tooltip]="@@ncrequestview_TT16"
            [attr.data-tooltip]="
              'The person on whose behalf the order is placed; may be same as the creator.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
          </label>
          <ng-autocomplete
            [data]="requesterOptions"
            [searchKeyword]="'fullname'"
            name="vpor_req1"
            i18n-placeholder="@@ncrequestviewEnterReq"
            placeHolder="Enter the Requester's name"
            historyIdentifier="requesterOptions"
            [itemTemplate]="requesterItemTemplate"
            [notFoundTemplate]="notFoundTemplate"
            formControlName="requester"
            disabled
          >
          </ng-autocomplete>
          <ng-template #requesterItemTemplate let-item>
            <a [innerHTML]="item.fullname"></a>
          </ng-template>
        </ng-container>
        <ng-container *ngIf="!editable">
          <label><span i18n="@@ncrequestviewReq">Requester&nbsp;</span>
            <span
            class="align-self-center tooltip--right position-relative"
            name='npor_tt6'
            i18n-[attr.data-tooltip]="@@ncrequestview_TT17"
            [attr.data-tooltip]="
              'The person on whose behalf the order is placed; may be same as the creator.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
          </label>
          <p name="vpor_req2">{{ poDetails.porRequest.requester.displayname }}</p>
        </ng-container>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group col-sm-4 ng-autocomplete hide-x">
        <ng-container *ngIf="vendorEditable">
          <label strong for="vendor"><strong i18n="@@ncrequestviewVendor">Vendor </strong>* &nbsp;
            <span
            class="align-self-center tooltip--right position-relative"
            name="npor_tt7"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT18"
            [attr.data-tooltip]="
              'Choose from existing vendors in the drop down menu.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
            <i
            class="pe-7s-note text-primary cursor-pointer"
            *ngIf="showEdit"
            name="vpor_editv"
            (click)="editVendor()"
          ></i></label>
          <ng-select
          [items]="vendorOptions"
          bindLabel="searchable"
          name="vpor_vendorop1"
          i18n-placeholder="@@ncrequestviewEnterVendor"
          placeholder="Enter the Vendor name"
          (change)="onVendorChange($event)"
          formControlName="vendor"
          [searchFn]="vendorSearchFn"
          [virtualScroll]="true"
        >
        <ng-template ng-footer-tmp *ngIf="vendorOptionsPref?.length">
          <div (click)="showMore('vendor')" i18n="@@ncrequestviewShowMore" class="cursor-pointer"  *ngIf="!showFullList.vendor">Show more...</div>
          <div (click)="showLess('vendor')" i18n="@@ncrequestviewShowLess" class="cursor-pointer"  *ngIf="showFullList.vendor">Show less...</div>
        </ng-template>
      </ng-select>
        <alert id="vendorLocked"></alert>

          <ng-template #vendorItemTemplate let-item>
            <a [innerHTML]="item.searchable"></a>
          </ng-template>
        </ng-container>
        <ng-container *ngIf="!vendorEditable">
          <label><span i18n="@@ncrequestviewVendor">Vendor&nbsp;</span>
            <span
            class="align-self-center tooltip--right position-relative"
            name="npor_tt7"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT19"
            [attr.data-tooltip]="
              'Choose from existing vendors in the drop down menu.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
          </label>
          <p name="vpor_vendorop2">{{ poDetails.porRequest.vendor.displayname }}</p>
        </ng-container>
        <ng-template #notFoundTemplate let-notFound>
          <div [innerHTML]="notFound"></div>
        </ng-template>
      </div>
      <div class="form-group col-sm-4 ng-autocomplete">
        <ng-container *ngIf="editable">
          <label for="currency"><strong i18n="@@ncrequestviewOrderCurMain">Order Currency </strong>*&nbsp;
            <span
            class="align-self-center tooltip--right position-relative"
            name="npor_tt8"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT20"
            [attr.data-tooltip]="
              'Usually, the same currency that will be used to remit payment to the vendor.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
          </label>
          <select
            id="currency"
            type="select"
            formControlName="currency"
            class="form-control"
            name="vpor_currency1"
            required
            (change)="onCurrencyChange()"
            disabled
          >
            <option value="" selected disabled hidden i18n="@@ncrequestviewPleaseChoose">Please choose...</option>
            <option
              value="{{ option.ID }}"
              *ngFor="let option of currencyOptions"
              >{{ option.name }}</option
            >
          </select>
        </ng-container>
        <ng-container *ngIf="!editable">
          <label><span i18n="@@ncrequestviewOrderCurMain">Order Currency&nbsp;</span>
            <span
                  class="align-self-center tooltip--right position-relative"
                  name="npor_tt8"
                  i18n-[attr.data-tooltip]="@@ncrequestview_TT21"
                  [attr.data-tooltip]="
                    'Usually, the same currency that will be used to remit payment to the vendor.'
                  "
                  ><i class="pe-7s-help1"></i
                ></span>
          </label>
          <p name="vpor_currency2">{{ poDetails.porRequest.orderCurrency.displayname }}</p>
        </ng-container>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group col-sm-6">
        <label for="detailsField"><strong i18n="@@ncrequestviewVendorDetails">Vendor Details </strong>*&nbsp;
          <span
          class="align-self-center tooltip--right position-relative"
          name="npor_tt10"
          ><i class="pe-7s-help1"></i
        ></span>
        </label>
        <textarea
          formControlName="detailsField"
          id="detailsField"
          name="vpor_vdetails1"
          class="form-control"
          rows="5"
          required
          readonly
        ></textarea>
        <div class="form-group">
          <h4>
            <span i18n="@@ncrequestviewShipTo">Ship To Address &nbsp;</span>            
            <span
              class="align-self-center tooltip--right position-relative"
              name="npor_tt11"
              i18n-[attr.data-tooltip]="@@ncrequestview_TT22"
              [attr.data-tooltip]="
                'Defaults to corporate office address based on company. Ship to address can be edited as necessary'
              "
              ><i class="pe-7s-help1"></i
            ></span>
            <i
              class="pe-7s-note text-primary cursor-pointer"
              *ngIf="showEdit"
              name="vpor_editaddress"
              (click)="editShipTo()"
              [hidden]="editableChecked.docApproved && !hasApprovalAccess"
            ></i>
          </h4>
          <div class="form-row">
            <div class="col">
              <label for="name" i18n="@@ncrequestviewName">Name</label>
              <input
                id="name"
                name="name"
                autocomplete="off"
                type="text"
                formControlName="shipToName"
                class="form-control"
                (change)="onHeaderUpdated('shipToName', $event)"
              />
            </div>
            <div class="col">
              <label for="street" i18n="@@ncrequestviewStreet">Street</label>
              <input
                id="street"
                name="street"
                autocomplete="off"
                type="text"
                formControlName="shipToStreet"
                class="form-control"
                (change)="onHeaderUpdated('shipToStreet', $event)"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="col">
              <label for="city" i18n="@@ncrequestviewCity">City</label>
              <input
                id="city"
                autocomplete="off"
                name="city"
                type="text"
                formControlName="shipToCity"
                class="form-control"
                (change)="onHeaderUpdated('shipToCity', $event)"
              />
            </div>
            <div class="col">
              <label for="state" i18n="@@ncrequestviewState">State</label>
              <!-- <input
                id="state"
                type="text"
                formControlName="shipToState"
                class="form-control small-input"
                (change)="onHeaderUpdated('shipToState', $event)"
              /> -->
              <ng-select
                 [items]="stateByCountryOptions || stateOptions"
                 bindLabel="{{returnStateBinds('label')}}"
                 bindValue="{{returnStateBinds('value')}}"
                 id="state"
                 name="state"
                 formControlName="shipToState"
                 (change)="onStateCountryEdited('shipToState')"
                 [readonly]="!requestDetailsForm.value.shipToCountry"
                 i18n-placeholder="@@ncrequestviewChooseCountry"
                 placeholder="Choose a Country first..."
                 appendTo="body"
                >
                </ng-select>
            </div>
          </div>
          <div class="form-row">
            <div class="col">
              <label for="zip" i18n="@@ncrequestviewZip">Zip</label>
              <input
                id="zip"
                name="zip"
                autocomplete="off"
                type="text"
                formControlName="shipToZip"
                class="form-control"
                (change)="onHeaderUpdated('shipToZip', $event)"
              />
            </div>
            <div class="col">
              <label for="country" i18n="@@ncrequestviewCountry">Country</label>
              <!-- <input
                id="country"
                type="text"
                formControlName="shipToCountry"
                class="form-control small-input"
                (change)="onHeaderUpdated('shipToCountry', $event)"
              /> -->
              <ng-select
                  [items]="countryOptions"
                  bindLabel="name"
                  bindValue="code"
                  id="country"
                  name="country"
                  formControlName="shipToCountry"
                  (change)="onStateCountryEdited('shipToCountry')"
                  i18n-placeholder="@@ncrequestviewChoose"
                  placeholder="Choose..."
                  appendTo="body"
                >
                </ng-select>
            </div>
          </div>
          <div class="form-row">
            <div class="col">
              <label for="shipToAttentionTo" i18n="@@ncrequestviewAttentionTo">Attention To *</label>
              <input
                id="shipToAttentionTo"
                name="shipToAttentionTo"
                type="text"
                autocomplete="off"
                formControlName="shipToAttentionTo"
                class="form-control"
                (change)="onHeaderUpdated('shipToAttentionTo', $event)"
              />
            </div>
            <div class="col"></div>
          </div>
        </div>
      </div>
      <div class="form-group col-sm-2">
        <label for="refNumber"><strong i18n="@@ncrequestviewVendorRef">Vendor Reference</strong>&nbsp;
          <span
            class="align-self-center tooltip--right position-relative"
            name="npor_tt17"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT23"
            [attr.data-tooltip]="
              'Enter a quote or other reference number that is useful to the vendor.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
        </label>
        <input
          type="text"
          class="form-control"
          id="refNumber"
          name="venref"
          autocomplete="off"
          formControlName="referenceNumber"
          disabled
          value="bind later"
          readonly
        />
        <div class="row d-flex" *ngIf="requestDetailsForm?.value?.company?.companyCode?.match(brazil)">
          <div class="reference-number form-group">
            <div class="d-flex">
              <p i18n="@@ncrequestviewSAPContractPO">SAP Contract PO: {{requestDetailsForm.value.contractFlag ? 'Yes' : 'No'}}</p>
            </div>
          </div>
        </div>
        <label for="startDate" *ngIf="typeForm.value.reqRadios != 2"
          ><strong i18n="@@ncrequestviewConStDt">Contract Start Date<ng-container *ngIf="requestDetailsForm?.value?.company?.companyCode?.match(brazil) && requestDetailsForm?.value?.contractFlag"> *</ng-container></strong>&nbsp;
          <span
          class="align-self-center tooltip--right position-relative"
          name="npor_tt19"
          i18n-[attr.data-tooltip]="@@ncrequestview_TT24"
          [attr.data-tooltip]="
            'For services to be provided over a period of time.'
          "
          ><i class="pe-7s-help1"></i
        ></span>
          <i
            class="pe-7s-note text-primary cursor-pointer"
            *ngIf="showEdit"
            name="vpor_editcdate"
            (click)="editHeaderDetail('startDate')"
            [hidden]="editableChecked.docApproved && !hasApprovalAccess"
          ></i
        ></label>
        <label for="startDate" *ngIf="typeForm.value.reqRadios == 2"
          ><strong i18n="@@ncrequestviewPStDt">Purchase Start Date<ng-container *ngIf="requestDetailsForm?.value?.company?.companyCode?.match(brazil) && requestDetailsForm?.value?.contractFlag"> *</ng-container></strong>&nbsp;
          <span
              class="align-self-center tooltip--right position-relative"
              name="npor_tt19"
              i18n-[attr.data-tooltip]="@@ncrequestview_TT24"
              [attr.data-tooltip]="
                'For services to be provided over a period of time.'
              "
              ><i class="pe-7s-help1"></i
            ></span>
          <i
            class="pe-7s-note text-primary cursor-pointer"
            *ngIf="showEdit"
            name="vpor_editpdate"
            (click)="editHeaderDetail('startDate')"
            [hidden]="editableChecked.docApproved && !hasApprovalAccess"
          ></i
        ></label>
        <input
          type="date"
          id="startDate"
          name="vpor_sdate"
          class="form-control"
          formControlName="startDate"
          (focusout)="onHeaderUpdated('startDate', $event)"
        />
        <label for="endDate" *ngIf="typeForm.value.reqRadios != 2"
          ><strong i18n="@@ncrequestviewConEDt">Contract End Date<ng-container *ngIf="requestDetailsForm?.value?.company?.companyCode?.match(brazil) && requestDetailsForm?.value?.contractFlag"> *</ng-container></strong>&nbsp;
          <span
            class="align-self-center tooltip--right position-relative"
            name="npor_tt20"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT25"
            [attr.data-tooltip]="
              'For services to be provided over a period of time.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
          <i
            class="pe-7s-note text-primary cursor-pointer"
            *ngIf="showEdit"
            name="vpor_editcenddate"
            (click)="editHeaderDetail('endDate')"
            [hidden]="editableChecked.docApproved && !hasApprovalAccess"
          ></i
        ></label>
        <label for="endDate" *ngIf="typeForm.value.reqRadios == 2"
          ><strong i18n="@@ncrequestviewPEnDt">Purchase End Date<ng-container *ngIf="requestDetailsForm?.value?.company?.companyCode?.match(brazil) && requestDetailsForm?.value?.contractFlag"> *</ng-container></strong>&nbsp;
          <span
            class="align-self-center tooltip--right position-relative"
            name="npor_tt20"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT25"
            [attr.data-tooltip]="
              'For services to be provided over a period of time.'
            "
            ><i class="pe-7s-help1"></i
          ></span>
          <i
            class="pe-7s-note text-primary cursor-pointer"
            *ngIf="showEdit"
            name="vpor_editpenddate"
            (click)="editHeaderDetail('endDate')"
            [hidden]="editableChecked.docApproved && !hasApprovalAccess"
          ></i
        ></label>
        <input
          type="date"
          class="form-control"
          id="endDate"
          name="vpor_enddate"
          formControlName="endDate"
          (focusout)="onHeaderUpdated('endDate', $event)"
        />
      </div>
      <div class="form-group col-sm-2">
        <label for="trackingNumber"
          ><strong i18n="@@ncrequestviewAttentionToVendor">Vendor Contact</strong>&nbsp;
          <span
            class="align-self-center tooltip--right position-relative"
            name="npor_tt18"
            i18n-[attr.data-tooltip]="@@ncrequestview_TT26"
            [attr.data-tooltip]="
              'Vendor contact name (for internal use only)'
            "
            ><i class="pe-7s-help1"></i
          ></span>
          <i
            class="pe-7s-note text-primary cursor-pointer"
            *ngIf="showEdit"
            name="vpor_editattention"
            (click)="editHeaderDetail('attentionTo')"
            [hidden]="editableChecked.docApproved && !hasApprovalAccess"
          ></i
        ></label>
        <input
          type="text"
          autocomplete="off"
          class="form-control"
          formControlName="attentionTo"
          id="trackingNumber"
          name="vpor_trackno"
          value="bind later"
          (change)="onHeaderUpdated('attentionTo', $event)"
        />
      </div>
    </div>
    <h4>
      <span i18n="@@ncrequestviewSendPO">Send Purchase Order By&nbsp;</span>      
      <span
        class="align-self-center tooltip--right position-relative"
        name="npor_tt21"
        i18n-[attr.data-tooltip]="@@ncrequestview_TT27"
        [attr.data-tooltip]="
          'To send a PDF copy of the PO automatically by email, enter an address.  Enter a fax number if email not available.'
        "
        ><i class="pe-7s-help1"></i
      ></span>
      <i
        class="pe-7s-note text-primary cursor-pointer"
        (click)="editEmailFax()"
        name="vpor_editmail"
        *ngIf="showEdit"
        [hidden]="editableChecked.docApproved && !hasApprovalAccess"
      ></i>
    </h4>
    <div class="form-row">
      <div class="col-sm-2">
        <div class="form-check">
          <input
            class="form-check-input"
            formControlName="sendEmail"
            name="sendEmail"
            type="checkbox"
            id="commsRadio1"
            value="1"
            (change)="onCommsChange()"
          />
          <label for="commsRadio1" i18n="@@ncrequestviewEmail">Email</label>
        </div>
        <input
          type="text"
          id="email"
          autocomplete="off"
          name="vpor_email"
          formControlName="email"
          class="form-control"
          value="bind later"
          (change)="onHeaderUpdated('email', $event)"
        />
      </div>
      <div class="col-sm-2">
        <div class="form-check">
          <input
            class="form-check-input"
            formControlName="sendFax"
            name="sendFax"
            type="checkbox"
            id="commsRadio2"
            value="2"
            (change)="onCommsChange()"
          />
          <label for="commsRadio2" i18n="@@ncrequestviewFax">Fax</label>
        </div>
        <input
          type="text"
          id="fax"
          autocomplete="off"
          name="vpor_fax"
          formControlName="fax"
          class="form-control"
          value="bind later"
          (change)="onHeaderUpdated('fax', $event)"
        />
      </div>
    </div>
  </div>
</form>
<div *ngIf="typeForm.value.reqRadios">
  <p *ngIf="debug">This part works! Finish later!</p>
  <div class="card p-4 m-5 shadow-lg">
    <ngx-spinner name="itemSpinner">
      <p class="loading"></p>
    </ngx-spinner>
    <h4 i18n="@@ncrequestviewItemDetails">Item Details</h4>
    <div class="card m-1 overflow-auto shadow-sm">
      <table class="table table-striped table-bordered m-0 custom-table">
        <thead>
          <tr>
            <th *ngIf="!phase1"></th>
            <th i18n="@@ncrequestviewILine">Line#</th>
            <ng-container *ngIf="poDetails.porRequest.itemDetails[0].material"
              ><th *ngIf="typeForm.value.reqRadios != 2">
                <span i18n="@@ncrequestviewIMat"> Material&nbsp;</span>
               
                <span
                class="tooltip--right position-relative"
                name="npor_tt22"
                ><i class="pe-7s-help1"></i
              ></span>
              </th></ng-container
            >
            <th>
              <span i18n="@@ncrequestviewDesc">Line Item Description *&nbsp;</span>
              <span
                  class="tooltip--right position-relative"
                  name="npor_tt23"
                  i18n-[attr.data-tooltip]="@@ncrequestview_TT28"
                  [attr.data-tooltip]="
                    'Description of the goods or services being purchased. Use the additional text field if you need more space to describe the line item'
                  "
                  ><i class="pe-7s-help1"></i
                ></span>
            </th>
            <!-- <ng-container  *ngIf="poDetails.porRequest.itemDetails[0].material"> -->
            <th i18n="@@ncrequestviewVenMatNo" *ngIf="typeForm.value.reqRadios != 2">Vendor Material No.</th>
            <!-- </ng-container> -->
            <th i18n="@@ncrequestviewQty">Qty *</th>
            <th i18n="@@ncrequestviewUOM">UOM *</th>
            <th i18n="@@ncrequestviewDD">Delivery Date</th>
            <th i18n="@@ncrequestviewUnitCost">Unit Cost *</th>
            <th i18n="@@ncrequestviewPriceUnit" [hidden]="true">Price Unit</th>
            <th i18n="@@ncrequestviewOrderCur">Order Currency&nbsp;
              <span
              class="tooltip--right position-relative"
              name="npor_tt30"
              i18n-[attr.data-tooltip]="@@ncrequestview_TT29"
              [attr.data-tooltip]="
                'Usually, the same currency that will be used to remit payment to the vendor.'
              "
              ><i class="pe-7s-help1"></i
            ></span>
            </th>
            <th>
              <span i18n="@@ncrequestviewTotalItemCost">Total Item Cost in Order Currency&nbsp;</span>
              <span
                  class="tooltip--right position-relative"
                  name="npor_tt31"
                  i18n-[attr.data-tooltip]="@@ncrequestview_TT30"
                  [attr.data-tooltip]="
                    'This value will be calculated by the system.'
                  "
                  ><i class="pe-7s-help1"></i
                ></span>
            </th>
            <th [hidden]="hideIfUsd()">
              <span  i18n="@@ncrequestviewTotalInUSD">Total Item Cost in USD&nbsp;</span>
              <span
                  class="tooltip--right position-relative"
                  name="npor_tt32"
                  i18n-[attr.data-tooltip]="@@ncrequestview_TT31"
                  [attr.data-tooltip]="
                    'This value will be calculated by the system.'
                  "
                  ><i class="pe-7s-help1"></i
                ></span>
            </th>
            <th>
              <span i18n="@@ncrequestviewFreeItem">Free Item&nbsp;</span>
              <span
              class="tooltip--right position-relative"
              name="npor_tt33"
              i18n-[attr.data-tooltip]="@@ncrequestview_TT32"
              [attr.data-tooltip]="
                'Check this box if the item is free of charge.'
              "
              ><i class="pe-7s-help1"></i
            ></span>
            </th>
            <th class="force-no-border bg-white">&nbsp;</th>
          </tr>
        </thead>
        <!-- TODO: finish resizing field width -->
        <tbody *ngFor="let row of tableForm; let i = index">
          <tr>
            <td *ngIf="!phase1">
              <div class="d-inline">
                <!-- <a class="toggler m-1">
                  <span>
                    <span
                      class="text-primary tooltippy tooltippy--right position-relative" [attr.data-tooltippy]="'Distribution currently disabled.'"
                    ><i class="pe-7s-help1"></i></span>
                  </span>
                </a> -->
                <a class="toggler m-1" (click)="toggleTableExtra(row)">
                  <span>
                    <span
                      class="pe-7s-angle-down-circle text-primary"
                      *ngIf="!row.extraOpen"
                    ></span>
                    <span
                      class="pe-7s-angle-up-circle text-primary"
                      *ngIf="row.extraOpen"
                    ></span>
                  </span>
                </a>
                <a
                  class="toggler m-1 d-none"
                  (click)="removeTableExtra(row)"
                  *ngIf="row.extra"
                >
                  <span>
                    <span class="pe-7s-trash text-danger"></span>
                  </span>
                </a>
              </div>
            </td>
            <td>
              <!-- <span class="form-control">{{ i + 1 }}</span> -->
              <input
                type="text"
                autocomplete="off"
                name="{{'id'+i}}"
                value="{{ i + 1 }}"
                readonly
                class="form-control"
                style="width:3em;"
                readonly
              />
            </td>
            <ng-container *ngIf="poDetails.porRequest.itemDetails[0].material">
              <td *ngIf="typeForm.value.reqRadios != 2">
                <input
                  type="text"
                  autocomplete="off"
                  class="form-control"
                  name="{{ row.material }}"
                  [(ngModel)]="row.material"
                  maxlength="18"
                  style="width: 13em;"
                  readonly
                />
                <!-- size="10" -->
              </td>
            </ng-container>
            <td>
              <input
                [(ngModel)]="row.shortText"
                class="form-control"
                type="text"
                autocomplete="off"
                name="{{ row.shortText }}"
                required
                maxlength="40"
                style="width:15em;"
                readonly
              />
            </td>
            <!-- <ng-container *ngIf="poDetails.porRequest.itemDetails[0].material"> -->
            <td *ngIf="typeForm.value.reqRadios != 2">
              <input
                type="text"
                autocomplete="off"
                class="form-control"
                name="{{ row.vendorMaterialNo }}"
                [(ngModel)]="row.vendorMaterialNo"
                maxlength="35"
                style="width: 13em;"
                readonly
              />
              <!-- size="10" -->
            </td>
            <!-- </ng-container> -->
            <td>
              <input
                [ngModel]="row.qty | customNumber : numberFormat"
                (ngModelChange)="row.qty=customNumberPipe.transform($event,numberFormat, '',true);"
                class="form-control"
                type="text"
                autocomplete="off"
                min="0"
                name="{{ row.qty }}"
                required
                max="9999999999999"
                style="width:13em;"
                (change)="onRowUpdate(row)"
                readonly
              />
              <!-- size="10" -->
            </td>
            <td>
              <ngx-spinner name="uomBox"></ngx-spinner>
              <div *ngIf="uomOptions" class="d-inline-flex">
                <ng-select
                  [items]="uomOptions"
                  placeholder="..."
                  [(ngModel)]="row.uom"
                  name="{{ row.uom }}"
                  required
                  style="width: 6.5em;"
                  (change)="onItemDetailUpdated('uom', i, $event)"
                  bindValue="id"
                  bindLabel="searchable"
                  appendTo="body"
                  class="dropdown-width-fix"
                  appendTo="body"
                  [disabled]="!editableChecked.UOM[i]"
                >
                  <ng-template ng-option-tmp let-item="item">
                    <div>{{ item.unit }} - {{ item.description }}</div>
                  </ng-template>
                  <ng-template ng-footer-tmp *ngIf="uomOptionsPref?.length">
                    <div (click)="showMore('uom')" class="cursor-pointer" i18n="@@ncrequestviewShowMore"  *ngIf="!showFullList.uom">Show more...</div>
                    <div (click)="showLess('uom')" class="cursor-pointer" i18n="@@ncrequestviewShowLess"  *ngIf="showFullList.uom">Show less...</div>
                  </ng-template>
                </ng-select>
                &nbsp;<i
                  class="pe-7s-note text-primary cursor-pointer"
                  (click)="editItemUOM(i)"
                  name="vpor_uomedit"
                  *ngIf="showEdit"
                  [hidden]="editableChecked.docApproved && !hasApprovalAccess"
                ></i>
              </div>
              <div *ngIf="!uomOptions" class="d-inline-flex">
                <input
                  class="form-control"
                  style="width: 6em;"
                  disabled
                  value="{{
                    poDetails.porRequest.itemDetails[i].uom.displayname
                  }}"
                />
                &nbsp;<i
                  class="pe-7s-note text-primary cursor-pointer"
                  *ngIf="showEdit"
                  name="vpor_edituom"
                  (click)="editItemUOM(i)"
                  [hidden]="editableChecked.docApproved && !hasApprovalAccess"
                ></i>
              </div>
            </td>
            <td>
              <div class="d-inline-flex">
                <input
                [(ngModel)]="row.deliveryDate"
                type="date"
                class="form-control"
                name="{{ row.deliveryDate }}"
                [disabled]="!editableChecked.deliveryDate[i]"
                (change)="checkDeliveryDate(row, i, $event.target.value)"
              />&nbsp;<i
              class="pe-7s-note text-primary cursor-pointer"
              (click)="editItemDetail('deliveryDate', i)"
              *ngIf="showEdit"
              [hidden]="editableChecked.docApproved && !hasApprovalAccess"
            ></i>
              </div>
              <alert id='DeliveryDate{{i}}'></alert>
            </td>
            <td>
              <input
                [ngModel]="row.unitCost | customNumber : numberFormat"
                (ngModelChange)="row.unitCost=customNumberPipe.transform($event,numberFormat, '',true);"
                class="form-control"
                type="text"
                autocomplete="off"
                min="0"
                name="{{ row.unitCost }}"
                required
                (change)="onRowUpdate(row)"
                max="9999999999999"
                style="width: 13em;"
                readonly
              /><!-- size="10" -->
            </td>
            <td [hidden]="true">
              <input
                type="number"
                autocomplete="off"
                class="form-control"
                name="{{ row.priceUnit }}"
                [(ngModel)]="row.priceUnit"
                max="99999"
                style="width: 4em;"
                readonly
              /><!-- size="1" -->
            </td>
            <td>
              <ng-container *ngIf="editable">
                <select
                  [(ngModel)]="row.orderCurrency"
                  class="form-control"
                  type="select"
                  name="{{ row.orderCurrency }}"
                  (change)="onRowUpdate(row)"
                  style="width: 6em;"
                  disabled
                >
                  <option value="undefined" selected disabled hidden>-</option>
                  <option
                    value="{{ option.ID }}"
                    *ngFor="let option of currencyOptions"
                    >{{ option.name }}
                  </option>
                </select>
              </ng-container>
              <ng-container *ngIf="!editable">
                <input
                  style="width:6 em;"
                  class="form-control"
                  name="vpor_orderc"
                  disabled
                  value="{{
                    poDetails.porRequest.itemDetails[i].orderCurrency
                      .displayname
                  }}"
                />
              </ng-container>
            </td>
            <td>
              <input
                [ngModel]="row.totalCost | customNumber : numberFormat"
                (ngModelChange)="row.totalCost=customNumberPipe.transform($event,numberFormat, '',true);"
                class="form-control"
                type="text"
                autocomplete="off"
                name="{{ row.totalCost}}"
                readonly
                style="width:13em;"
              />
            </td>
            <td [hidden]="hideIfUsd()">
              <input
                [ngModel]="row.totalUsd | customNumber : numberFormat"
                (ngModelChange)="row.totalUsd=customNumberPipe.transform($event,numberFormat, '',true);"
                class="form-control"
                type="text"
                name="{{ row.totalUsd | number : '1.2-2'}}"
                readonly
                style="width:13em;"
              />
            </td>
            <td>
              <input type="checkbox" name="{{ row.isFree }}" [(ngModel)]="row.isFree" class="form-check-input" disabled>
            </td>
            <td class="force-no-border">
              <button
                class="btn btn-danger"
                type="button"
                name="{{'deleteline'+i}}"
                (click)="deleteTableValue(i)"
                disabled
                i18n="@@ncrequestviewDelete"
              >
                Delete
              </button>
            </td>
          </tr>
          <tr>
            <td *ngIf="!phase1">&nbsp;</td>
            <td colspan="13">
              <div class="form-row d-flex">
                <div>
                  <h4 i18n="@@ncrequestviewCostObjInfo">
                    Cost Object Information
                    <i
                      class="pe-7s-note text-primary cursor-pointer"
                      *ngIf="showEdit"
                      id="{{'editco'+i}}"
                      (click)="editCostObject(i)"
                      [hidden]="editableChecked.docApproved && !hasApprovalAccess"
                    ></i>
                  </h4>
                </div>
              </div>
              <!-- <div *ngIf="!checkNewTableFormatWithoutError(row)">API error retrieving Cost Object Info at Item level.</div> -->
              <div class="form-row d-flex">
                <!-- *ngIf="checkNewTableFormatWithoutError(row)" -->
                <div class="" *ngIf="chosenPor.glAccountNumber">
                  <div class="form-group gl-account">
                    <label for="coGLAccount"
                      ><strong i18n="@@ncrequestviewGLAcc">GL Account </strong>*&nbsp;
                      <span
                        class="align-self-center tooltip--right position-relative"
                        i18n-[attr.data-tooltip]="@@ncrequestview_TT33"
                        [attr.data-tooltip]="
                          'Enter the general ledger account number to be charged for this line item.'
                        "
                        ><i class="pe-7s-help1"></i
                      ></span>
                      </label
                    >
                    <ng-select
                      [items]="glAccountOptions"
                      bindValue="id"
                      bindLabel="searchable"
                      id="coGLAccount"
                      (change)="onGlAccountChange(row, $event, i)"
                      placeholder="Choose a GL Account"
                      i18n-placeholder="@@ncrequestviewChooseGL"
                      [(ngModel)]="row.glAccountMasterId"
                      appendTo="body"
                      [disabled]="!editableChecked.costObjectInfo[i]"
                    >
                    <ng-template ng-footer-tmp *ngIf="glAccountOptionsPref?.length">
                      <div (click)="showMore('glaccount')" i18n="@@ncrequestviewShowMore" class="cursor-pointer"  *ngIf="!showFullList.glaccount">Show more...</div>
                      <div (click)="showLess('glaccount')" i18n="@@ncrequestviewShowLess" class="cursor-pointer"  *ngIf="showFullList.glaccount">Show less...</div>
                    </ng-template>
                      <ng-template ng-option-tmp let-item="item">
                        <div>{{ item.accDesc }}</div>
                        <small>{{ item.accountNumber | glAccount }}</small>
                      </ng-template>
                    </ng-select>
                  </div>
                </div>
                <div class="" *ngIf="chosenPor.costCenterCode">
                  <div class="form-group cost-center">
                    <label for="coCostCenter"
                      ><strong i18n="@@ncrequestviewCostCenter">Cost Center </strong>*&nbsp;
                      <span
                        class="align-self-center tooltip--right position-relative"
                        name="npor_tt34"
                        i18n-[attr.data-tooltip]="@@ncrequestview_TT34"
                        [attr.data-tooltip]="
                          'Enter the cost  center to be charged for this line item.'
                        "
                        ><i class="pe-7s-help1"></i
                      ></span>
                      </label
                    >
                    <ng-select
                      [items]="costCenterOptions"
                      id="coCostCenter"
                      (change)="onItemDetailCCChange($event, i)"
                      bindValue="id"
                      bindLabel="searchable"
                      i18n-placeholder="ncrequestviewChooseCostCenter"
                      placeholder="Choose a Cost Center"
                      [(ngModel)]="row.costCenterId"
                      appendTo="body"
                      disabled
                    >
                      <ng-template ng-option-tmp let-item="item">
                        <div>{{ item.name }}</div>
                        <small>{{ item.code }}</small>
                      </ng-template>
                    </ng-select>
                  </div>
                  <alert id="costCenterLocked{{i}}"></alert>
                </div>
                <div class="" *ngIf="chosenPor.assetClass">
                  <div class="form-group asset-type">
                    <label for="coAssetClass"
                      ><strong i18n="@@ncrequestviewAssetType">Asset Type</strong> *&nbsp;
                      <span
                      class="align-self-center tooltip--right position-relative"
                      name="npor_tt35"
                      i18n-[attr.data-tooltip]="@@ncrequestview_TT35"
                      [attr.data-tooltip]="
                        'Select asset type from dropdown menu. '
                      "
                      ><i class="pe-7s-help1"></i
                    ></span>
                      </label
                    >
                    <ng-select
                      [items]="assetClassOptions"
                      bindValue="id"
                      bindLabel="searchable"
                      (change)="onItemDetailAssetChange($event, i)"
                      id="coAssetClass"
                      i18n-placeholder="@@ncrequestviewChooseAsset"
                      placeholder="Choose Asset Type"
                      [(ngModel)]="row.assetClass"
                      appendTo="body"
                      [virtualScroll]="true"
                      [disabled]="!editableChecked.costObjectInfo[i]"
                    >
                      <ng-template ng-option-tmp let-item="item">
                        <div>{{ item.description }}</div>
                        <small>{{ item.classCode }}</small>
                      </ng-template>
                    </ng-select>
                  </div>
                  <alert id="assetClassLocked{{i}}"></alert>
                </div>
                <div class="" *ngIf="chosenPor.assetNumber">
                  <div class="form-group asset-number">
                    <label for="coAssetNumber"
                      ><strong i18n="@@ncrequestviewAssetNo">Asset Number&nbsp;</strong>
                      <span
                        class="align-self-center tooltip--right position-relative"
                        i18n-[attr.data-tooltip]="@@ncrequestview_TT36"
                        [attr.data-tooltip]="
                          'Asset number will be entered by fixed asset reviewer.'
                        "
                        ><i class="pe-7s-help1"></i
                      ></span>
                      </label
                    >
                    <ng-select
                      [items]="assetNumberOptions"
                      bindValue="id"
                      bindLabel="searchable"
                      id="coAssetNumber"
                      (change)="onItemDetailsANChange($event, i)"
                      i18n-placeholder="@@ncrequestviewProvideAssetNo"
                      placeholder="(Optional) - Provide Asset Number"
                      [(ngModel)]="row.assetNumber"
                      appendTo="body"
                      [disabled]="!editableChecked.costObjectInfo[i]"
                      [virtualScroll]="true"
                    >
                      <ng-template ng-option-tmp let-item="item">
                        <div>{{ item.classDescription }}</div>
                        <small>{{ item.assetNumber }}</small>
                      </ng-template>
                    </ng-select>
                  </div>
                  <alert id="assetNumberLocked{{i}}"></alert>
                </div>
                <div class="" *ngIf="chosenPor.ioNumber">
                  <div class="form-group internal-order">
                    <label for="coInternalOrder"
                      ><strong i18n="@@ncrequestviewIO">Internal Order</strong><ng-container *ngIf="row.ioOptions && row.ioOptions.internalOrderFlag">*&nbsp;</ng-container>
                      <span
                        class="align-self-center tooltip--right position-relative"
                        i18n-[attr.data-tooltip]="@@ncrequestview_TT37"
                        [attr.data-tooltip]="
                          'Enter an internal order number to be charged if known.'
                        "
                        ><i class="pe-7s-help1"></i
                      ></span>
                      </label
                    >
                    <ng-select
                      [items]="row.ioOptions?.internalOrder || []"
                      bindValue="id"
                      bindLabel="searchable"
                      id="coInternalOrder"
                      (change)="onItemDetailsIOChange($event, i)"
                      i18n-placeholder="@@ncrequestviewChooseIO"
                      placeholder="(optional) - Choose IO number"
                      [(ngModel)]="row.ioNumber"
                      appendTo="body"
                      [disabled]="
                        !editableChecked.costObjectInfo[i] ||
                        ioDisabledHelper(
                          chosenPor.glAccountNumber,
                          row.glAccountMasterId
                        )
                      "
                    >
                      <ng-template ng-option-tmp let-item="item">
                        <div>{{ item.orderDes }}</div>
                        <small>{{ item.orderNumber }}</small>
                      </ng-template>
                    </ng-select>
                  </div>
                  <alert id="ioNumberLocked{{i}}"></alert>
                </div>
                <div class="" *ngIf="chosenPor.profitCenter">
                  <div class="form-group profit-center">
                    <label for="coProfitCenter"
                      ><strong i18n="@@ncrequestviewPC">Profit Center&nbsp;</strong>
                      <span
                        class="align-self-center tooltip--right position-relative"
                        i18n-[attr.data-tooltip]="@@ncrequestview_TT38"
                        [attr.data-tooltip]="
                          'Required for purchases to be charged to cost of sales.'
                        "
                        ><i class="pe-7s-help1"></i
                      ></span>
                      </label
                    >
                    <ng-select
                      [items]="profitCenterOptions"
                      bindValue="id"
                      bindLabel="name"
                      id="coProfitCenter"
                      (change)="onItemDetailsPCChange($event, i)"
                      placeholder="Choose a Profit Center"
                      i18n-placeholder="@@ncrequestviewChoosePC"
                      [(ngModel)]="row.profitCenter"
                      appendTo="body"
                      disabled
                    >
                      <ng-template ng-option-tmp let-item="item">
                        <div>{{ item.name }}</div>
                        <small>{{ item.code }}</small>
                      </ng-template>
                    </ng-select>
                  </div>
                  <alert id="profitCenterLocked{{i}}"></alert>
                </div>
              </div>
            </td>
          </tr>
          <tr *ngIf="phase1 || row.extraOpen">
            <td *ngIf="!phase1">&nbsp;</td>
            <td colspan="7">
              <div class="form-row">
                <p><strong i18n="@@ncrequestviewAddText">Additional Text:&nbsp;</strong>

                  <span
                  class="align-self-center tooltip--right position-relative"
                  i18n-[attr.data-tooltip]="@@ncrequestview_TT39"
                  [attr.data-tooltip]="
                    'Provides additional space to describe or explain line item for vendor.'
                  "
                  ><i class="pe-7s-help1"></i
                ></span>
                </p>
                <input
                  type="text"
                  autocomplete="off"
                  id="tableExtraText"
                  name="{{ row.extraText }}"
                  class="form-control"
                  [(ngModel)]="row.extraText"
                  readonly
                />
              </div>
            </td>
          </tr>
          <tr *ngIf="row.extraOpen && !phase1">
            <td>
              &nbsp;
            </td>
            <td colspan="7">
              <div class="form-row">
                <p><strong i18n="@@ncrequestviewDistBasis">Distribution Basis:</strong></p>
                <select
                  type="select"
                  id="tableExtraDistributionBasis"
                  name="{{ row.tableExtraDistributionBasis }}"
                  class="form-control"
                  [(ngModel)]="row.tableExtraDistributionBasis"
                  disabled
                >
                  <option value="1" i18n="@@ncrequestviewQuantity">Quantity</option>
                  <option value="2" i18n="@@ncrequestviewPercentage">Percentage</option>
                </select>
              </div>
            </td>
          </tr>
          <ng-container *ngIf="row.extraOpen && !phase1">
            <tr
              *ngFor="let extraRow of tableForm[i].distribution; let j = index"
            >
              <td>&nbsp;</td>
              <td colspan="13">
                <div class="row align-items-center align-content-center">
                  <div class="col-sm-auto">
                    <button
                      class="btn btn-dark bg-smartbuy shape-square-sm custom-circle"
                      (click)="addTableExtra(row)"
                      disabled
                    >
                      +
                    </button>
                  </div>
                  <div class="col-sm-auto">
                    <p><strong i18n="@@ncrequestviewSr">Sr. #</strong></p>
                    <!-- <span class="form-control">{{ j + 1 }}</span> -->
                    <input
                      type="text"
                      autocomplete="off"
                      class="form-control"
                      value="{{ j + 1 }}"
                      readonly
                      style="width:3em;"
                    />
                  </div>
                  <div class="col-sm-auto">
                    <div class="">
                      <p class="text-left"><strong i18n="@@ncrequestviewQty1">Qty:</strong></p>
                      <input
                        type="number"
                        autocomplete="off"
                        min="0"
                        id="extraRowQty"
                        name="{{ extraRow.extraRowQty }}"
                        class="form-control"
                        max="9999999999999"
                        [(ngModel)]="extraRow.extraRowQty"
                        disabled
                        style="width:13em;"
                      /><!-- [disabled]="row.tableExtraDistributionBasis != 1" -->
                    </div>
                  </div>
                  <div class="col-sm-auto">
                    <div class="">
                      <p class="text-left"><strong i18n="@@ncrequestviewPer">Percentage:</strong></p>
                      <input
                        type="number"
                        autocomplete="off"
                        min="0"
                        max="100"
                        id="extraRowPercentage"
                        name="{{ extraRow.extraRowPercentage }}"
                        class="form-control"
                        [(ngModel)]="extraRow.extraRowPercentage"
                        [disabled]="row.tableExtraDistributionBasis != 2"
                        style="width:6em;"
                        readonly
                      />
                    </div>
                  </div>
                  <div class="col-sm-auto">
                    <div class="">
                      <p class="text-left"><strong i18n="@@ncrequestviewCostCenter1">Cost Center:&nbsp;</strong>
                        <span
                        class="align-self-center tooltip--right position-relative"
                        name="npor_tt34"
                        i18n-[attr.data-tooltip]="@@ncrequestview_TT40"
                        [attr.data-tooltip]="
                          'Enter the cost  center to be charged for this line item.'
                        "
                        ><i class="pe-7s-help1"></i
                      ></span>
                      </p>
                      <select
                        type="select"
                        id="extraRowCostCenter"
                        name="{{ extraRow.extraRowCostCenter }}"
                        class="form-control"
                        [(ngModel)]="extraRow.extraRowCostCenter"
                        disabled
                      >
                        <option value="undefined" disabled hidden selected
                          >-</option
                        >
                        <option
                          value="{{ item.id }}"
                          *ngFor="let item of costCenterOptions"
                        >
                          {{ item.code }}</option
                        >
                      </select>
                    </div>
                  </div>

                  <div class="col-sm-auto">
                    <div class="">
                      <p class="text-left"><strong i18n="@@ncrequestviewGLAcc1">G/L Account:</strong></p>
                      <select
                        type="select"
                        id="extraRowGlAccount"
                        name="{{ extraRow.extraRowGlAccount }}"
                        class="form-control"
                        [(ngModel)]="extraRow.extraRowGlAccount"
                        disabled
                      >
                        <option value="undefined" disabled hidden selected
                          >-</option
                        >
                        <option
                          *ngFor="let item of glAccountOptions"
                          value="{{ item.id }}"
                        >
                          {{ item.accountNumber }}</option
                        >
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-auto">
                    <button
                      class="btn btn-danger shape-square-sm custom-circle"
                      (click)="deleteExtraValue(row, j)"
                      disabled
                    >
                      -
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="14">
              <button
                type="button"
                class="btn btn-primary btn-sm d-none"
                id="addrow"
                (click)="addTableValue()"
                disabled
                i18n="@@ncrequestviewAddRow"
              >
                Add Row

              </button>
              <span class="text-right float-right clearfix">
                <strong  name="vpor_totalcost">{{ displayTotalCost() }}</strong>
              </span>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
<form *ngIf="typeForm.value.reqRadios" [formGroup]="commentsForm">
  <div class="card p-4 m-5 shadow-lg">
    <div class="form-group">
      <label for="specialInstructions"
        ><strong i18n="@@ncrequestviewSpclInstToVendor">Special Instructions to Vendor</strong> &nbsp;
        <span
          class="align-self-center tooltip--right position-relative"
          i18n-[attr.data-tooltip]="@@ncrequestview_TT41"
          [attr.data-tooltip]="
            'These instructions will appear on the PO sent to the vendor.'
          "
          ><i class="pe-7s-help1"></i
        ></span>
        <i
          class="pe-7s-note text-primary cursor-pointer"
          *ngIf="showEdit"
          name="vpor_editcomment"
          (click)="editCommentsDetail('specialInstructions')"
          [hidden]="editableChecked.docApproved && !hasApprovalAccess"
        ></i
      ></label>
      <textarea
        name="specialInstructions"
        id="specialInstructions"
        formControlName="specialInstructions"
        class="form-control"
        (change)="onHeaderUpdated('specialInstructions', $event)"
        [disabled]="!editableChecked.specialInstructions"
      ></textarea>
    </div>
  </div>
</form>
<div *ngIf="watchersView">
  <div class="card p-4 m-5 shadow-lg">
    <h1>
      <span i18n="@@ncrequestviewAddReaders">Additional Readers&nbsp;</span>
      <span
      class="align-self-center tooltip--right position-relative"
      name="npor_tt40"
      i18n-[attr.data-tooltip]="@@ncrequestview_TT42"
      [attr.data-tooltip]="
        'Additional readers can see the POR but cannot approve.'
      "
      ><i class="pe-7s-help1"></i
    ></span>
    </h1>
    <div class="form-row">
      <div class="col-lg">
        <div class="form-group">
          <ng-select
            [items]="adUsers"
            [virtualScroll]="true"
            bindValue="ID"
            bindLabel="firstname"
            id="addWatchers"
            (change)="onAddWatcher()"
            [(ngModel)]="chosenWatcher"
            [attr.name]="'addWatcher'"
            class="approver"
            i18n-placeholder="@@ncrequestviewSelectReader"
            placeholder="Select your desired reader"
            [searchFn]="watcherSearchFn"
          >
            <ng-template ng-option-tmp let-item="item">
              <div>{{ item.firstname }} {{ item.lastname }}</div>
            </ng-template>
            <ng-template ng-label-tmp let-item="item">
              <span>{{item.firstname}} {{item.lastname}}</span>
            </ng-template>
          </ng-select>
        </div>
      </div>
      <div class="col-lg">
        <div>
          <span class="btn btn-secondary m-2" *ngFor="let person of watchers; let i = index"
            >{{ person.firstname }} {{ person.lastname }}
            <a  name="{{'removewatcher'+i}}" (click)="onRemoveWatcher(person)"><i class="pe-7s-close"></i></a>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- <button *ngIf="debug" (click)="sendAllData('test', validateForms())">
  Debug: Test submit of order
</button> -->

<div class="p-1 shadow-lg fixed-btn" *ngIf="contentEdited">
  <button i18n="@@ncrequestviewSubmitChanges" class="btn btn-primary button-fix half-width" name="vpor_submitupdate" (click)="submitUpdate()">
    Submit Changes
  </button>
  <button i18n="@@ncrequestviewResetChanges" class="btn btn-danger btn-danger-fix half-width" name="vpor_reset" (click)="resetPage()">Reset Changes</button>
</div>

<ngx-smart-modal
  #askQuestionModal
  identifier="askQuestionModal"
  target="button#pendingClarification"
>
  <h4 class="modal-header" i18n="@@ncrequestviewSendEmail">Send Email...</h4>
  <form class="modal-body" [formGroup]="sendEmailForm">
    <label for="toEmail" i18n="@@ncrequestviewTo">To:</label>
    <ng-select
      formControlName="emailTo"
      id="toEmail"
      [items]="adUsers"
      [virtualScroll]="true"
      bindLabel="emailId"
      bindValue="emailId"
      [multiple]=true
      i18n-placeholder="@@ncrequestviewSendEmailAddress"
      placeholder="Select email address"
    >
    </ng-select>
    <br>
    <label for="ccEmail" i18n="@@ncrequestviewccemail">Cc:</label>
    <ng-select
      formControlName="emailCc"
      id="ccEmail"
      [items]="adUsers"
      [virtualScroll]="true"
      bindLabel="emailId"
      bindValue="emailId"
      [multiple]=true
      i18n-placeholder="@@ncrequestviewSendEmailAddress"
      placeholder="Select email address"
    >
    </ng-select>
    <br>
    <!-- <input type="email" formControlName="emailCc" id="ccEmail" class="form-control" /> -->
    <label for="emailSubject" i18n="@@ncrequestviewSubject">Subject:</label>
    <input type="text" autocomplete="off" formControlName="emailSubject" id="emailSubject" class="form-control" />
    <hr>
    <label for="clarifyText" i18n="@@ncrequestviewMsg">Message:</label>
    <textarea
      formControlName="emailMsg"
      id="clarifyText"
      class="form-control"
      maxlength="200"
      onkeyup="document.getElementById('clarifyTextCCount').innerText = this.value.length + '/200'"
    ></textarea>
    <small id="clarifyTextCCount">0/200</small>
  </form>
  <div class="modal-footer">
    <button i18n="@@ncrequestviewSubmit1" name="vpor_sendemail" class="btn btn-primary button-fix" (click)="onSendEmail(askQuestionModal)" [disabled]="!sendEmailForm.valid">
      Submit
    </button>
    <button i18n="@@ncrequestviewCancel1" name="vpor_cancelemail" class="btn btn-danger" (click)="askQuestionModal.close()">
      Cancel
    </button>
  </div>
</ngx-smart-modal>
